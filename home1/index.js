// –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∑–∞–Ω—è—Ç–∏–π.

// –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ç–∞–±–ª–∏—Ü–∞ —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∑–∞–Ω—è—Ç–∏–π, –Ω–∞ –æ—Å–Ω–æ–≤–µ JSON-–¥–∞–Ω–Ω—ã—Ö.
// –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–Ω—è—Ç–∏–∏, –∞ –∏–º–µ–Ω–Ω–æ:
// - –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏—è
// - –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∑–∞–Ω—è—Ç–∏—è
// - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
// - —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
// - –∫–Ω–æ–ø–∫–∞ "–∑–∞–ø–∏—Å–∞—Ç—å—Å—è"
// - –∫–Ω–æ–ø–∫–∞ "–æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å"

// –ï—Å–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ, –ª–∏–±–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω –Ω–∞ –∑–∞–Ω—è—Ç–∏–µ, —Å–¥–µ–ª–∞–π—Ç–µ –∫–Ω–æ–ø–∫—É "–∑–∞–ø–∏—Å–∞—Ç—å—Å—è" –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π.
// –ö–Ω–æ–ø–∫–∞ "–æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å" –∞–∫—Ç–∏–≤–Ω–∞ –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–∏—Å–∞–Ω –Ω–∞ –∑–∞–Ω—è—Ç–∏–µ, –∏–Ω–∞—á–µ –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞.

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –æ–¥–∏–Ω –∫—É—Ä—Å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑.

// –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "–∑–∞–ø–∏—Å–∞—Ç—å—Å—è" —É–≤–µ–ª–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
// –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å", —É–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
// –û–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

// –ï—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —É–∂–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ, —Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–ª—Å—è —Ä–∞–Ω–µ–µ.

// –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ LocalStorage, —á—Ç–æ–±—ã –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

// –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (JSON):

// [
//     {
//         "id": 1,
//         "name": "–ô–æ–≥–∞",
//         "time": "10:00 - 11:00",
//         "maxParticipants": 15,
//         "currentParticipants": 8
//     },
//     {
//         "id": 2,
//         "name": "–ü–∏–ª–∞—Ç–µ—Å",
//         "time": "11:30 - 12:30",
//         "maxParticipants": 10,
//         "currentParticipants": 9
//     },
//     {
//         "id": 3,
//         "name": "–ö—Ä–æ—Å—Å—Ñ–∏—Ç",
//         "time": "13:00 - 14:00",
//         "maxParticipants": 20,
//         "currentParticipants": 15
//     },
//     {
//         "id": 4,
//         "name": "–¢–∞–Ω—Ü—ã",
//         "time": "14:30 - 15:30",
//         "maxParticipants": 12,
//         "currentParticipants": 10
//     },
//     {
//         "id": 5,
//         "name": "–ë–æ–∫—Å",
//         "time": "16:00 - 17:00",
//         "maxParticipants": 8,
//         "currentParticipants": 6
//     }
// ]

const localStorageKey = 'lessons';
const userStorageKey = 'userCourses';
const initialLessons = `[
    {
        "id": 1,
        "name": "–ô–æ–≥–∞",
        "time": "10:00 - 11:00",
        "maxParticipants": 15,
        "currentParticipants": 8
    },
    {
        "id": 2,
        "name": "–ü–∏–ª–∞—Ç–µ—Å",
        "time": "11:30 - 12:30",
        "maxParticipants": 10,
        "currentParticipants": 9
    },
    {
        "id": 3,
        "name": "–ö—Ä–æ—Å—Å—Ñ–∏—Ç",
        "time": "13:00 - 14:00",
        "maxParticipants": 20,
        "currentParticipants": 15
    },
    {
        "id": 4,
        "name": "–¢–∞–Ω—Ü—ã",
        "time": "14:30 - 15:30",
        "maxParticipants": 12,
        "currentParticipants": 11
    },
    {
        "id": 5,
        "name": "–ë–æ–∫—Å",
        "time": "16:00 - 17:00",
        "maxParticipants": 8,
        "currentParticipants": 6
    }
] `;

if (!localStorage.getItem(localStorageKey)) {
  localStorage.setItem(localStorageKey, initialLessons);
}
const lessons = JSON.parse(localStorage.getItem(localStorageKey));

if (!localStorage.getItem(userStorageKey)) {
  localStorage.setItem(userStorageKey, JSON.stringify([]));
}

const userCourses = JSON.parse(localStorage.getItem(userStorageKey));
const listLessonEl = document.querySelector('.list-lessons');


// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:
function timetable(item) {
  // –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –µ—Å–ª–∏ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —É–∂–µ –Ω–µ—Ç –º–µ—Å—Ç
  const isLessonFull = item.currentParticipants >= item.maxParticipants;
  // –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–±—Ä–∞–Ω –ª–∏ —Ä–∞–Ω–µ–µ –∫—É—Ä—Å
  const isUserSelected = userCourses.includes(item.id);
  const isLastPlace = item.currentParticipants === item.maxParticipants - 1; // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –º–µ—Å—Ç–æ

  listLessonEl.insertAdjacentHTML(
    'beforeend',
    `
      <div class="lesson" data-id="${item.id}">
        <div class="nameLesson">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏—è: ${item.name}</div>
        <div class="timeLesson">–í—Ä–µ–º—è: ${item.time}</div>
        <div class="maxParticipants">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${item.maxParticipants}</div>
        <div class="currentParticipants">–¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${item.currentParticipants}</div>
        <button class="btnRecord" ${isUserSelected || isLessonFull ? 'disabled' : ''}>üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
        <button class="btnCancel" ${!isUserSelected || isLastPlace ? 'disabled' : ''}>üóëÔ∏è –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
      </div>
    `,
  );
}
// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"
listLessonEl.addEventListener('click', ({ target }) => {
  const fatherEl = target.closest('.lesson');
  const lessonId = parseInt(fatherEl.getAttribute('data-id'));
  const lesson = lessons.find((item) => item.id === lessonId);

  if (target.matches('.btnRecord')) {
    if (lesson.currentParticipants < lesson.maxParticipants) {
      lesson.currentParticipants += 1;
      fatherEl.querySelector('.currentParticipants').textContent = `–¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${lesson.currentParticipants}`;
      fatherEl.querySelector('.btnRecord').setAttribute('disabled', true);
      fatherEl.querySelector('.btnCancel').removeAttribute('disabled');
      userCourses.push(lesson.id);
      saveUserCourses(userCourses);
      saveData(lessons);
    } else {
      fatherEl.querySelector('.btnRecord').setAttribute('disabled', true);

    }
  } else if (target.matches('.btnCancel')) {
    if (lesson.currentParticipants > 0) {
      lesson.currentParticipants -= 1;
      fatherEl.querySelector('.currentParticipants').textContent = `–¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${lesson.currentParticipants}`;
      fatherEl.querySelector('.btnRecord').removeAttribute('disabled');
      fatherEl.querySelector('.btnCancel').setAttribute('disabled', true);
      userCourses = userCourses.filter((courseId) => courseId !== lesson.id);
      saveUserCourses(userCourses);
      saveData(lessons);
    }
  }
});
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ LocalStorage:
function saveData(array) {
  localStorage.setItem(localStorageKey, JSON.stringify(array));
}
function saveUserCourses(array) {
  localStorage.setItem(userStorageKey, JSON.stringify(array));
}
lessons.forEach(timetable);
